import{_ as s,b as i,c as n,d as l}from"./app.D-A8O3CX.js";import"./chunks/vendor.8Zb1yHKv.js";import"./chunks/vendor-mermaid.BZfVRecf.js";const u=JSON.parse('{"title":"EMCShop（等价交换商店）","description":"","frontmatter":{"contributors":"F.windEmiko,FwindEmi86"},"headers":[],"relativePath":"develop/mc_plugins/emcshop.md","filePath":"develop/mc_plugins/emcshop.md","lastUpdated":1769617561000}'),e={name:"develop/mc_plugins/emcshop.md"};function p(r,a,h,t,k,d){return i(),n("div",null,[...a[0]||(a[0]=[l(`<h1 id="emcshop-等价交换商店" tabindex="-1">EMCShop（等价交换商店） <a class="header-anchor" href="#emcshop-等价交换商店" aria-label="Permalink to &quot;EMCShop（等价交换商店）&quot;">​</a></h1><h2 id="项目概述" tabindex="-1">项目概述 <a class="header-anchor" href="#项目概述" aria-label="Permalink to &quot;项目概述&quot;">​</a></h2><p>EMCShop 是一个为 Minecraft Paper 服务器设计的经济插件，提供物品转换、购买和预览功能。该插件允许玩家将基础物品转换为更有价值的物品，或直接购买解锁的物品。</p><h2 id="技术栈" tabindex="-1">技术栈 <a class="header-anchor" href="#技术栈" aria-label="Permalink to &quot;技术栈&quot;">​</a></h2><ul><li><strong>Java</strong>: 21</li><li><strong>Minecraft API</strong>: Paper 1.21.4</li><li><strong>数据库</strong>: MySQL / SQLite (可选)</li><li><strong>连接池</strong>: HikariCP</li><li><strong>经济系统</strong>: Vault API / 独立 EMC 系统</li><li><strong>构建工具</strong>: Maven</li></ul><h2 id="项目结构" tabindex="-1">项目结构 <a class="header-anchor" href="#项目结构" aria-label="Permalink to &quot;项目结构&quot;">​</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" tabindex="0"><code><span class="line"><span>EMCShop/</span></span>
<span class="line"><span>├── src/main/java/top/MiragEdge/emc/</span></span>
<span class="line"><span>│   ├── EMCShop.java              # 主插件类</span></span>
<span class="line"><span>│   ├── Commands/                 # 命令处理</span></span>
<span class="line"><span>│   │   ├── MainCommand.java      # 主命令</span></span>
<span class="line"><span>│   │   ├── PurchaseCommand.java  # 购买命令</span></span>
<span class="line"><span>│   │   ├── ViewCommand.java      # 查看命令</span></span>
<span class="line"><span>│   │   ├── ConvertCommand.java   # 转换命令</span></span>
<span class="line"><span>│   │   ├── ItemCommand.java      # 物品命令</span></span>
<span class="line"><span>│   │   └── ReloadCommand.java    # 重载命令</span></span>
<span class="line"><span>│   ├── Data/                     # 数据模型</span></span>
<span class="line"><span>│   │   └── PlayerData.java       # 玩家数据</span></span>
<span class="line"><span>│   ├── Database/                 # 数据库层</span></span>
<span class="line"><span>│   │   ├── DatabaseConnector.java # 数据库连接器</span></span>
<span class="line"><span>│   │   └── DatabaseManager.java  # 数据库管理器</span></span>
<span class="line"><span>│   ├── Gui/                      # GUI 菜单</span></span>
<span class="line"><span>│   │   ├── ConvertMenu.java      # 转换菜单</span></span>
<span class="line"><span>│   │   ├── PreviewMenu.java      # 预览菜单</span></span>
<span class="line"><span>│   │   └── PurchaseMenu.java     # 购买菜单</span></span>
<span class="line"><span>│   ├── Manager/                  # 业务逻辑管理</span></span>
<span class="line"><span>│   │   └── EMCManager.java       # EMC 管理器</span></span>
<span class="line"><span>│   └── Utils/                    # 工具类</span></span>
<span class="line"><span>│       ├── LocalizationUtil.java # 本地化工具</span></span>
<span class="line"><span>│       └── MessageUtil.java      # 消息工具</span></span>
<span class="line"><span>└── src/main/resources/</span></span>
<span class="line"><span>    ├── plugin.yml                # 插件配置</span></span>
<span class="line"><span>    ├── config.yml                # 主配置文件</span></span>
<span class="line"><span>    ├── message.yml               # 消息配置</span></span>
<span class="line"><span>    └── items.yml                 # 物品配置</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="核心功能" tabindex="-1">核心功能 <a class="header-anchor" href="#核心功能" aria-label="Permalink to &quot;核心功能&quot;">​</a></h2><h3 id="_1-数据库管理" tabindex="-1">1. 数据库管理 <a class="header-anchor" href="#_1-数据库管理" aria-label="Permalink to &quot;1. 数据库管理&quot;">​</a></h3><h4 id="databasemanager-databasemanager-java-1" tabindex="-1">DatabaseManager (DatabaseManager.java:1) <a class="header-anchor" href="#databasemanager-databasemanager-java-1" aria-label="Permalink to &quot;DatabaseManager (DatabaseManager.java:1)&quot;">​</a></h4><p>负责管理数据库操作，包括：</p><ul><li>异步数据保存和加载</li><li>动态批处理优化</li><li>死锁重试机制</li><li>定期清理过期数据</li><li>内存泄漏防护</li></ul><p>关键特性：</p><ul><li>使用 TransferQueue 实现高效的任务队列</li><li>支持 MySQL 和 SQLite 两种数据库</li><li>动态调整批处理大小以优化性能</li><li>弱引用缓存防止内存泄漏</li></ul><h3 id="_2-emc-管理" tabindex="-1">2. EMC 管理 <a class="header-anchor" href="#_2-emc-管理" aria-label="Permalink to &quot;2. EMC 管理&quot;">​</a></h3><h4 id="emcmanager-emcmanager-java-1" tabindex="-1">EMCManager (EMCManager.java:1) <a class="header-anchor" href="#emcmanager-emcmanager-java-1" aria-label="Permalink to &quot;EMCManager (EMCManager.java:1)&quot;">​</a></h4><p>管理 EMC 经济系统和玩家数据：</p><ul><li>支持 Vault 和独立 EMC 两种经济模式</li><li>玩家解锁物品管理</li><li>经济交易操作（存取款）</li><li>玩家数据缓存和持久化</li></ul><h3 id="_3-gui-菜单系统" tabindex="-1">3. GUI 菜单系统 <a class="header-anchor" href="#_3-gui-菜单系统" aria-label="Permalink to &quot;3. GUI 菜单系统&quot;">​</a></h3><h4 id="convertmenu-convertmenu-java-1" tabindex="-1">ConvertMenu (ConvertMenu.java:1) <a class="header-anchor" href="#convertmenu-convertmenu-java-1" aria-label="Permalink to &quot;ConvertMenu (ConvertMenu.java:1)&quot;">​</a></h4><p>物品转换界面，提供：</p><ul><li>批量转换功能</li><li>实时价值计算</li><li>转换进度显示</li><li>异常恢复机制</li></ul><h3 id="_4-命令系统" tabindex="-1">4. 命令系统 <a class="header-anchor" href="#_4-命令系统" aria-label="Permalink to &quot;4. 命令系统&quot;">​</a></h3><h4 id="maincommand-maincommand-java-1" tabindex="-1">MainCommand (MainCommand.java:1) <a class="header-anchor" href="#maincommand-maincommand-java-1" aria-label="Permalink to &quot;MainCommand (MainCommand.java:1)&quot;">​</a></h4><p>主命令入口，支持以下子命令：</p><ul><li><code>/emcshop purchase</code> - 打开购买菜单</li><li><code>/emcshop view</code> - 打开预览菜单</li><li><code>/emcshop convert</code> - 打开转换菜单</li><li><code>/emcshop item</code> - 查看手持物品价值</li><li><code>/emcshop reload</code> - 重载配置</li></ul><h2 id="配置文件" tabindex="-1">配置文件 <a class="header-anchor" href="#配置文件" aria-label="Permalink to &quot;配置文件&quot;">​</a></h2><h3 id="config-yml" tabindex="-1">config.yml <a class="header-anchor" href="#config-yml" aria-label="Permalink to &quot;config.yml&quot;">​</a></h3><p>主配置文件，包含：</p><ul><li>经济系统设置</li><li>数据库配置（MySQL/SQLite）</li><li>重构损耗率</li><li>数据库连接池参数</li></ul><h3 id="items-yml" tabindex="-1">items.yml <a class="header-anchor" href="#items-yml" aria-label="Permalink to &quot;items.yml&quot;">​</a></h3><p>物品价值配置，定义每个物品的基础 EMC 价值：</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">EMC_VALUES</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  BASE</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    GRASS_BLOCK</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    STONE</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # ... 更多物品</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="message-yml" tabindex="-1">message.yml <a class="header-anchor" href="#message-yml" aria-label="Permalink to &quot;message.yml&quot;">​</a></h3><p>消息配置，支持 MiniMessage 格式：</p><ul><li>转换菜单消息</li><li>预览菜单消息</li><li>购买菜单消息</li><li>通用系统消息</li></ul><h2 id="数据库设计" tabindex="-1">数据库设计 <a class="header-anchor" href="#数据库设计" aria-label="Permalink to &quot;数据库设计&quot;">​</a></h2><h3 id="mysql-表结构" tabindex="-1">MySQL 表结构 <a class="header-anchor" href="#mysql-表结构" aria-label="Permalink to &quot;MySQL 表结构&quot;">​</a></h3><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- 玩家解锁物品表</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">CREATE</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> TABLE</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> player_unlocks</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  player_uuid </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">VARCHAR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">36</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">NOT NULL</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  item_id </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">VARCHAR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">64</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">NOT NULL</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  unlocked_at </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">TIMESTAMP</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> DEFAULT</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> CURRENT_TIMESTAMP,</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">  PRIMARY KEY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (player_uuid, item_id)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- 玩家 EMC 余额表</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">CREATE</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> TABLE</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> player_emc_balance</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  player_uuid </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">VARCHAR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">36</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">NOT NULL</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  balance </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">DECIMAL</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">15</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">2</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">DEFAULT</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">00</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  updated_at </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">TIMESTAMP</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> DEFAULT</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> CURRENT_TIMESTAMP,</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">  PRIMARY KEY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (player_uuid)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="sqlite-表结构" tabindex="-1">SQLite 表结构 <a class="header-anchor" href="#sqlite-表结构" aria-label="Permalink to &quot;SQLite 表结构&quot;">​</a></h3><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- 玩家解锁物品表</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">CREATE</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> TABLE</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> player_unlocks</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  player_uuid </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">TEXT</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> NOT NULL</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  item_id </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">TEXT</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> NOT NULL</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  unlocked_at </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">DATETIME</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> DEFAULT</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> CURRENT_TIMESTAMP,</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">  PRIMARY KEY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (player_uuid, item_id)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- 玩家 EMC 余额表</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">CREATE</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> TABLE</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> player_emc_balance</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  player_uuid </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">TEXT</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> NOT NULL</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  balance </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">REAL</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> DEFAULT</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">0</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  updated_at </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">DATETIME</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> DEFAULT</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> CURRENT_TIMESTAMP,</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">  PRIMARY KEY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (player_uuid)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="开发指南" tabindex="-1">开发指南 <a class="header-anchor" href="#开发指南" aria-label="Permalink to &quot;开发指南&quot;">​</a></h2><h3 id="_1-添加新物品价值" tabindex="-1">1. 添加新物品价值 <a class="header-anchor" href="#_1-添加新物品价值" aria-label="Permalink to &quot;1. 添加新物品价值&quot;">​</a></h3><ol><li>编辑 <code>src/main/resources/items.yml</code></li><li>在 <code>EMC_VALUES.BASE</code> 部分添加新物品：<div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">NEW_ITEM</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 10</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # 物品ID: 价值</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li>重启服务器使配置生效</li></ol><h3 id="_2-添加新命令" tabindex="-1">2. 添加新命令 <a class="header-anchor" href="#_2-添加新命令" aria-label="Permalink to &quot;2. 添加新命令&quot;">​</a></h3><ol><li>在 <code>Commands/</code> 目录创建新的命令类</li><li>实现 <code>CommandExecutor</code> 或 <code>TabExecutor</code> 接口</li><li>在 <code>MainCommand.java</code> 中注册新命令</li></ol><h3 id="_3-添加新菜单" tabindex="-1">3. 添加新菜单 <a class="header-anchor" href="#_3-添加新菜单" aria-label="Permalink to &quot;3. 添加新菜单&quot;">​</a></h3><ol><li>在 <code>Gui/</code> 目录创建菜单类</li><li>继承或实现相应的菜单接口</li><li>在 <code>EMCShop.java</code> 中初始化</li></ol><h3 id="_4-修改消息" tabindex="-1">4. 修改消息 <a class="header-anchor" href="#_4-修改消息" aria-label="Permalink to &quot;4. 修改消息&quot;">​</a></h3><ol><li>编辑 <code>src/main/resources/message.yml</code></li><li>添加或修改消息键值对</li><li>重启服务器或使用 <code>/emcshop reload</code> 命令重载</li></ol><h2 id="性能优化" tabindex="-1">性能优化 <a class="header-anchor" href="#性能优化" aria-label="Permalink to &quot;性能优化&quot;">​</a></h2><h3 id="数据库优化" tabindex="-1">数据库优化 <a class="header-anchor" href="#数据库优化" aria-label="Permalink to &quot;数据库优化&quot;">​</a></h3><ul><li>使用批量操作减少数据库连接</li><li>动态调整批处理大小</li><li>死锁重试机制</li><li>定期清理过期数据</li></ul><h3 id="内存管理" tabindex="-1">内存管理 <a class="header-anchor" href="#内存管理" aria-label="Permalink to &quot;内存管理&quot;">​</a></h3><ul><li>使用 WeakReference 防止内存泄漏</li><li>异步数据处理</li><li>玩家数据缓存机制</li></ul><h3 id="线程安全" tabindex="-1">线程安全 <a class="header-anchor" href="#线程安全" aria-label="Permalink to &quot;线程安全&quot;">​</a></h3><ul><li>使用 ConcurrentHashMap 保护共享数据</li><li>异步数据库操作</li><li>玩家数据锁机制</li></ul><h2 id="部署指南" tabindex="-1">部署指南 <a class="header-anchor" href="#部署指南" aria-label="Permalink to &quot;部署指南&quot;">​</a></h2><h3 id="_1-构建插件" tabindex="-1">1. 构建插件 <a class="header-anchor" href="#_1-构建插件" aria-label="Permalink to &quot;1. 构建插件&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mvn</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> clean</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> package</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_2-部署插件" tabindex="-1">2. 部署插件 <a class="header-anchor" href="#_2-部署插件" aria-label="Permalink to &quot;2. 部署插件&quot;">​</a></h3><ol><li>将生成的 JAR 文件复制到 Paper 服务器的 plugins 目录</li><li>配置 <code>config.yml</code> 中的数据库设置</li><li>重启服务器</li></ol><h3 id="_3-配置数据库" tabindex="-1">3. 配置数据库 <a class="header-anchor" href="#_3-配置数据库" aria-label="Permalink to &quot;3. 配置数据库&quot;">​</a></h3><p>根据需要配置 MySQL 或 SQLite：</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">database</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  type</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mysql</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # 或 &quot;sqlite&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # MySQL 配置...</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # SQLite 配置...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="故障排除" tabindex="-1">故障排除 <a class="header-anchor" href="#故障排除" aria-label="Permalink to &quot;故障排除&quot;">​</a></h2><h3 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to &quot;常见问题&quot;">​</a></h3><ol><li><p><strong>数据库连接失败</strong></p><ul><li>检查 MySQL 连接配置</li><li>确认数据库服务正在运行</li><li>验证用户名和密码</li></ul></li><li><p><strong>性能问题</strong></p><ul><li>检查数据库连接池配置</li><li>监控 CPU 和内存使用</li><li>调整批处理大小</li></ul></li><li><p><strong>数据丢失</strong></p><ul><li>确保正确保存数据</li><li>检查磁盘空间</li><li>验证数据库备份</li></ul></li></ol><h3 id="日志分析" tabindex="-1">日志分析 <a class="header-anchor" href="#日志分析" aria-label="Permalink to &quot;日志分析&quot;">​</a></h3><p>插件日志包含详细的调试信息，可以帮助诊断问题：</p><ul><li>数据库操作日志</li><li>玩家数据加载/保存日志</li><li>经济交易日志</li><li>错误和警告信息</li></ul><h2 id="版本历史" tabindex="-1">版本历史 <a class="header-anchor" href="#版本历史" aria-label="Permalink to &quot;版本历史&quot;">​</a></h2><ul><li><strong>v3.14</strong> - 修复性能问题，优化数据库连接</li><li><strong>v3.0</strong> - 重大重构，支持多种数据库</li><li><strong>v2.0</strong> - 添加独立 EMC 经济系统</li><li><strong>v1.0</strong> - 初始版本，基础功能</li></ul><h2 id="贡献指南" tabindex="-1">贡献指南 <a class="header-anchor" href="#贡献指南" aria-label="Permalink to &quot;贡献指南&quot;">​</a></h2><ol><li>Fork 项目仓库</li><li>创建功能分支</li><li>提交代码更改</li><li>创建 Pull Request</li></ol><h2 id="许可证" tabindex="-1">许可证 <a class="header-anchor" href="#许可证" aria-label="Permalink to &quot;许可证&quot;">​</a></h2><p>本项目采用 MIT 许可证，详见 LICENSE 文件。</p><h2 id="联系方式" tabindex="-1">联系方式 <a class="header-anchor" href="#联系方式" aria-label="Permalink to &quot;联系方式&quot;">​</a></h2><ul><li>作者：狐风轩汐 &amp; F.windEmiko</li><li>项目地址：<a href="https://github.com/FwindEmi86/EMCShop" target="_blank" rel="noreferrer">https://github.com/FwindEmi86/EMCShop</a></li><li>文档地址：<a href="https://f.windemiko.top/wiki/emcshop" target="_blank" rel="noreferrer">https://f.windemiko.top/wiki/emcshop</a></li></ul>`,79)])])}const b=s(e,[["render",p]]);export{u as __pageData,b as default};
